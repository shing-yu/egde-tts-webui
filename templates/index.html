<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edge TTS 文本转语音工具</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="max-w-4xl mx-auto py-8 px-4">
        <header class="text-center mb-12">
            <h1 class="text-3xl font-bold text-indigo-700 mb-2">Edge TTS 文本转语音工具</h1>
            <p class="text-gray-600">将文本转换为自然语音并生成字幕文件</p>
        </header>

        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <form method="POST" enctype="multipart/form-data">
                {% if error %}
                <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6">
                    <i class="fas fa-exclamation-circle mr-2"></i>{{ error }}
                </div>
                {% endif %}
                
                <!-- 文本输入区域 -->
                <div id="text-input-container" class="mb-6">
                    <label class="block text-gray-700 font-medium mb-2" for="text_input">
                        输入文本
                    </label>
                    <textarea 
                        id="text_input" 
                        name="text_input" 
                        rows="8" 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        placeholder="请输入要转换的文本内容..."></textarea>
                </div>

                <!-- “或” 分隔符 -->
                <div id="or-separator" class="mb-6">
                    <div class="flex items-center mb-2">
                        <span class="block text-gray-700 font-medium mr-4">或</span>
                        <div class="border-t border-gray-300 flex-grow"></div>
                    </div>
                </div>
                
                <!-- 文件上传区域 -->
                <div id="file-upload-container" class="mb-6">
                    <div class="flex items-center justify-center">
                        <label for="file_input" class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100">
                            <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"></i>
                                <p class="mb-2 text-sm text-gray-500">点击上传或拖拽文件到此处</p>
                                <p class="text-xs text-gray-500">支持 .txt 格式</p>
                            </div>
                            <input id="file_input" type="file" name="text_file" class="hidden" accept=".txt">
                        </label>
                    </div>
                </div>

                <!-- 文件上传成功后显示的状态区域 -->
                <div id="file-status-container" class="hidden mb-6 bg-indigo-50 border border-indigo-200 rounded-lg p-4 flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-file-alt text-2xl text-indigo-600 mr-3"></i>
                        <span id="selected-filename" class="text-gray-800 font-medium"></span>
                    </div>
                    <button type="button" id="remove-file-btn" class="text-gray-500 hover:text-red-600 transition-colors">
                        <i class="fas fa-times-circle text-xl"></i>
                    </button>
                </div>


                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label class="block text-gray-700 font-medium mb-2" for="voice">
                            选择音色
                        </label>
                        <select id="voice" name="voice" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            {% for voice in voices %}
                            <option value="{{ voice.id }}">{{ voice.name }} ({{ voice.gender }}) - {{ voice.style }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-medium mb-2" for="words_in_cue">
                            每行字幕字数
                        </label>
                        <input 
                            type="number" 
                            id="words_in_cue" 
                            name="words_in_cue" 
                            min="5" 
                            max="20" 
                            value="10" 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div>
                        <label class="block text-gray-700 font-medium mb-2" for="rate">
                            语速增益
                        </label>
                        <select id="rate" name="rate" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            <option value="-20%">慢 (-20%)</option>
                            <option value="-10%">较慢 (-10%)</option>
                            <option value="+0%" selected>正常 (+0%)</option>
                            <option value="+10%">较快 (+10%)</option>
                            <option value="+20%">快 (+20%)</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-medium mb-2" for="volume">
                            音量增益
                        </label>
                        <select id="volume" name="volume" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            <option value="-20%">低 (-20%)</option>
                            <option value="-10%">较低 (-10%)</option>
                            <option value="+0%" selected>正常 (+0%)</option>
                            <option value="+10%">较高 (+10%)</option>
                            <option value="+20%">高 (+20%)</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-medium mb-2" for="pitch">
                            音调增益
                        </label>
                        <select id="pitch" name="pitch" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            <option value="-20Hz">低沉 (-20Hz)</option>
                            <option value="-10Hz">较低沉 (-10Hz)</option>
                            <option value="+0Hz" selected>正常 (+0Hz)</option>
                            <option value="+10Hz">较明亮 (+10Hz)</option>
                            <option value="+20Hz">明亮 (+20Hz)</option>
                        </select>
                    </div>
                </div>

                <div class="text-center">
                    <button 
                        type="submit" 
                        class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-lg transition duration-300 transform hover:scale-105">
                        <i class="fas fa-play-circle mr-2"></i>开始转换
                    </button>
                </div>
            </form>
        </div>

        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">使用说明</h2>
            <ul class="space-y-2 text-gray-600">
                <li class="flex items-start">
                    <i class="fas fa-check-circle text-green-500 mt-1 mr-2"></i>
                    <span>输入文本或上传TXT文件（最大30MB）</span>
                </li>
                <li class="flex items-start">
                    <i class="fas fa-check-circle text-green-500 mt-1 mr-2"></i>
                    <span>选择音色和调整语音参数</span>
                </li>
                <li class="flex items-start">
                    <i class="fas fa-check-circle text-green-500 mt-1 mr-2"></i>
                    <span>点击"开始转换"按钮生成语音和字幕</span>
                </li>
                <li class="flex items-start">
                    <i class="fas fa-check-circle text-green-500 mt-1 mr-2"></i>
                    <span>转换完成后可在线播放或下载文件</span>
                </li>
            </ul>
        </div>
    </div>
</body>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 获取所有需要操作的 DOM 元素
        const fileInput = document.getElementById('file_input');
        const fileUploadArea = document.querySelector('label[for="file_input"]');
        const textInputContainer = document.getElementById('text-input-container');
        const fileUploadContainer = document.getElementById('file-upload-container');
        const orSeparator = document.getElementById('or-separator');
        const fileStatusContainer = document.getElementById('file-status-container');
        const selectedFilenameSpan = document.getElementById('selected-filename');
        const removeFileBtn = document.getElementById('remove-file-btn');
        const textInput = document.getElementById('text_input');

        // 更新UI以显示已选择的文件
        function showFileStatus(file) {
            if (file) {
                // 隐藏输入框和上传框
                textInputContainer.classList.add('hidden');
                fileUploadContainer.classList.add('hidden');
                orSeparator.classList.add('hidden');
                
                // 清空文本框内容，防止同时提交文本和文件
                textInput.value = '';

                // 显示文件状态框
                selectedFilenameSpan.textContent = file.name;
                fileStatusContainer.classList.remove('hidden');
            }
        }

        // 重置UI到初始状态
        function resetToFileSelection() {
            // 显示输入框和上传框
            textInputContainer.classList.remove('hidden');
            fileUploadContainer.classList.remove('hidden');
            orSeparator.classList.remove('hidden');

            // 隐藏文件状态框
            fileStatusContainer.classList.add('hidden');
            selectedFilenameSpan.textContent = '';
            
            // 最重要的一步：清空文件输入的值，否则无法重新选择相同的文件
            fileInput.value = '';
        }

        // 文件拖放功能
        fileUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUploadArea.classList.add('border-indigo-500', 'bg-indigo-50');
        });
        
        fileUploadArea.addEventListener('dragleave', () => {
            fileUploadArea.classList.remove('border-indigo-500', 'bg-indigo-50');
        });
        
        fileUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUploadArea.classList.remove('border-indigo-500', 'bg-indigo-50');
            
            if (e.dataTransfer.files.length) {
                fileInput.files = e.dataTransfer.files;
                showFileStatus(e.dataTransfer.files[0]);
            }
        });
        
        // 文件选择后更新UI
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length) {
                showFileStatus(e.target.files[0]);
            }
        });

        // "移除"按钮的点击事件
        removeFileBtn.addEventListener('click', () => {
            resetToFileSelection();
        });
    });
</script>
</html>